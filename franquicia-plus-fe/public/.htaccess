RewriteEngine On

# www to non www redirect (mantener tu configuración actual)
RewriteBase /
RewriteCond %{HTTP_HOST} www.franquiciaplus.com [NC]
RewriteRule ^(.*)$ https://franquiciaplus.com/$1 [R=301,L]

# Http to https (mantener tu configuración actual)
RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} ^franquiciaplus\.com [NC]
RewriteRule ^(.*)$ https://franquiciaplus.com/$1 [R,L]

# Servir WebP cuando esté disponible y el navegador lo soporte
<IfModule mod_rewrite.c>
  # Para imágenes PNG
  RewriteCond %{HTTP_ACCEPT} image/webp
  RewriteCond %{REQUEST_FILENAME} \.(png)$
  RewriteCond %{REQUEST_FILENAME}\.webp -f
  RewriteRule ^(.+)$ $1.webp [T=image/webp,E=webp:1,L]
  
  # Para imágenes JPG/JPEG
  RewriteCond %{HTTP_ACCEPT} image/webp
  RewriteCond %{REQUEST_FILENAME} \.(jpe?g)$
  RewriteCond %{REQUEST_FILENAME}\.webp -f
  RewriteRule ^(.+)$ $1.webp [T=image/webp,E=webp:1,L]
</IfModule>

# Error 404 personalizado
ErrorDocument 404 /error.vue

<IfModule mod_headers.c>
  # Headers de seguridad
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "DENY"
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  
  # Cache optimizado por tipo de archivo (MUCHO MEJOR que deshabilitar todo)
  
  # Imágenes: Cache largo para SEO
  <FilesMatch "\.(jpg|jpeg|png|gif|webp|avif|ico|svg)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Expires "access plus 1 year"
    # Compresión para imágenes
    Header append Vary "Accept-Encoding"
  </FilesMatch>
  
  # Fuentes: Cache muy largo
  <FilesMatch "\.(woff2?|ttf|eot|otf)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Expires "access plus 1 year"
  </FilesMatch>
  
  # CSS y JS: Cache medio con revalidación
  <FilesMatch "\.(css|js)$">
    Header set Cache-Control "public, max-age=86400, must-revalidate"
    Header set Expires "access plus 1 day"
  </FilesMatch>
  
  # Videos: Cache largo
  <FilesMatch "\.(mp4|webm|ogg|avi|mov)$">
    Header set Cache-Control "public, max-age=2592000"
    Header set Expires "access plus 30 days"
  </FilesMatch>
  
  # HTML: Cache corto con revalidación
  <FilesMatch "\.(html|htm)$">
    Header set Cache-Control "public, max-age=3600, must-revalidate"
  </FilesMatch>
  
  # WebP específico con Vary header para SEO
  <FilesMatch "\.webp$">
    Header append Vary "Accept"
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>
  
  # API responses: Sin cache
  <FilesMatch "\.(json|xml)$">
    Header set Cache-Control "no-cache, no-store, must-revalidate"
    Header set Pragma "no-cache"
    Header set Expires "0"
  </FilesMatch>
</IfModule>

# Compresión GZIP para mejor performance
<IfModule mod_deflate.c>
  # Comprimir texto, html, javascript, css, xml
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/json
  
  # No comprimir imágenes (ya están comprimidas)
  SetEnvIfNoCase Request_URI \
    \.(?:gif|jpe?g|png|webp|avif)$ no-gzip dont-vary
</IfModule>

# Configuración de expiración alternativa (si mod_headers no está disponible)
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType text/css "access plus 1 day"
  ExpiresByType application/javascript "access plus 1 day"
  ExpiresByType font/woff2 "access plus 1 year"
</IfModule>

# Optimizaciones adicionales para SEO
<IfModule mod_mime.c>
  # Tipos MIME para formatos modernos
  AddType image/webp .webp
  AddType image/avif .avif
  AddType font/woff2 .woff2
</IfModule>
